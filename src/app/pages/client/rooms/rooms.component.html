<div class="flex h-screen w-full">

  <app-sidebar-izq
  class="bg-cyan-800 w-[20%] p-4  shadow-lg border-r border-cyan-700"
  [components]="components"
  [roomCode]="roomCode"
  [contextMenu]="contextMenu"
  [isModalOpen]="isModalOpen">
</app-sidebar-izq>

  <div class="flex flex-col flex-1 border border-none">

    <!-- Panel central: Canvas (BODY) -->
    <div
    #canvas
    class="flex-1 bg-white border border-cyan-300 overflow-auto p-6 m-4 rounded-lg relative"
    (contextmenu)="onCanvasContextMenu($event)"
    (mousemove)="onMouseMove($event)"
    (mouseup)="onMouseUp()"
  >
      <!-- Renderizado de componentes -->
      <ng-container *ngFor="let comp of components">
        <ng-container *ngTemplateOutlet="renderComponent; context: { comp: comp }"></ng-container>
      </ng-container>


      <!-- Menú contextual -->
      <div *ngIf="contextMenu.visible" [style.left.px]="contextMenu.x" [style.top.px]="contextMenu.y"
        class="fixed bg-white border rounded shadow z-[1000]">
        <button (click)="addChild(contextMenu.targetId)" class="block w-full px-4 py-2 hover:bg-gray-100 text-left">
          ➕ Agregar hijo
        </button>
        <button (click)="copyComponent(findComponentById(contextMenu.targetId, components)!)" class="block w-full px-4 py-2 hover:bg-gray-100 text-left">
          📋 Copiar
        </button>
        <button (click)="cutComponent(findComponentById(contextMenu.targetId, components)!)" class="block w-full px-4 py-2 hover:bg-gray-100 text-left">
          ✂️ Cortar
        </button>
        <button (click)="pasteComponent(contextMenu.targetId)" class="block w-full px-4 py-2 hover:bg-gray-100 text-left">
          📥 Pegar dentro
        </button>
        <button (click)="removeComponent(contextMenu.targetId)" class="block w-full px-4 py-2 hover:bg-gray-100 text-left text-red-600">
          🗑️ Eliminar
        </button>
      </div>

    </div>

  </div>








  <!-- Panel derecho: Propiedades -->
  <aside class="w-[20%] bg-cyan-800 p-4 text-white overflow-y-auto shadow-lg border-l border-cyan-700">

    <!-- Navegación -->
    <app-navegation></app-navegation>

    <app-sidebar-der [selectedComponent]="selectedComponent" [roomCode]="roomCode"></app-sidebar-der>
  </aside>

  <!-- Template de renderizado recursivo -->
  <ng-template #renderComponent let-comp="comp">
    <div class="border p-2 text-center cursor-move" [ngStyle]="comp.style" 
      [style.position]="comp.parentId ? 'absolute' : 'relative'" [style.min-width.px]="50" [style.min-height.px]="40"
      (mousedown)="onMouseDown($event, comp)" (click)="selectComponent(comp, $event)"
      (contextmenu)="onComponentContextMenu($event, comp.id)">
      <!-- Mostrar el contenido si existe -->
      {{ comp.content || comp.label }}

      <!-- Renderizar hijos si los hay -->
      <ng-container *ngIf="comp.children">
        <ng-container *ngFor="let child of comp.children">
          <ng-container *ngTemplateOutlet="renderComponent; context: { comp: child }"></ng-container>
        </ng-container>
      </ng-container>
    </div>
  </ng-template>


</div>