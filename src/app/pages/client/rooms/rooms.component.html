<div class="flex h-screen w-full">

  <app-sidebar-izq
  class="bg-cyan-800 w-[20%] p-4  shadow-lg border-r border-cyan-700"
  [components]="components"
  [roomCode]="roomCode"
  [contextMenu]="contextMenu"
  [isModalOpen]="isModalOpen">
</app-sidebar-izq>

  <div class="flex flex-col flex-1 border border-none">

    <!-- Panel central: Canvas (BODY) -->
    <div
    #canvas
    class="flex-1 bg-white border border-cyan-300 overflow-auto p-6 m-4 rounded-lg relative"
    (contextmenu)="onCanvasContextMenu($event)"
    (mousemove)="onMouseMove($event)"
    (mouseup)="onMouseUp()"
  >
      <!-- Renderizado de componentes -->
      <ng-container *ngFor="let comp of components">
        <ng-container *ngTemplateOutlet="renderComponent; context: { comp: comp }"></ng-container>
      </ng-container>


      <!-- Menú contextual -->
      <div *ngIf="contextMenu.visible" [style.left.px]="contextMenu.x" [style.top.px]="contextMenu.y"
        class="fixed bg-white border rounded shadow z-[1000]">
        <button (click)="addChild(contextMenu.targetId)" class="block w-full px-4 py-2 hover:bg-gray-100 text-left">
          ➕ Agregar hijo
        </button>
        <button (click)="copyComponent(findComponentById(contextMenu.targetId, components)!)" class="block w-full px-4 py-2 hover:bg-gray-100 text-left">
          📋 Copiar
        </button>
        <button (click)="cutComponent(findComponentById(contextMenu.targetId, components)!)" class="block w-full px-4 py-2 hover:bg-gray-100 text-left">
          ✂️ Cortar
        </button>
        <button (click)="pasteComponent(contextMenu.targetId)" class="block w-full px-4 py-2 hover:bg-gray-100 text-left">
          📥 Pegar dentro
        </button>
        <button (click)="removeComponent(contextMenu.targetId)" class="block w-full px-4 py-2 hover:bg-gray-100 text-left text-red-600">
          🗑️ Eliminar
        </button>
      </div>

    </div>

  </div>








  <!-- Panel derecho: Propiedades -->
  <aside class="w-[20%] bg-cyan-800 p-4 text-white overflow-y-auto shadow-lg border-l border-cyan-700">

    <!-- Navegación -->
    <app-navegation></app-navegation>

    <app-sidebar-der [selectedComponent]="selectedComponent" [roomCode]="roomCode"></app-sidebar-der>
  </aside>

  <!-- Template de renderizado recursivo -->
  <ng-template #renderComponent let-comp="comp">
    <ng-container [ngSwitch]="comp.type">
      <div
        *ngSwitchCase="'div'"
        [ngStyle]="comp.style"
        (mousedown)="onMouseDown($event, comp)"
        (click)="selectComponent(comp, $event)"
        (contextmenu)="onComponentContextMenu($event, comp.id)"
        class="absolute"
      >
        {{ comp.content }}
      </div>
  
      <label
        *ngSwitchCase="'label'"
        [ngStyle]="comp.style"
        (mousedown)="onMouseDown($event, comp)"
        (click)="selectComponent(comp, $event)"
        (contextmenu)="onComponentContextMenu($event, comp.id)"
        class="absolute"
      >
        {{ comp.content }}
      </label>
  
      <button
        *ngSwitchCase="'button'"
        class="absolute px-3 py-1 rounded bg-blue-600 text-white hover:bg-blue-700"
        [style.top]="comp.style.top"
        [style.left]="comp.style.left"
        (mousedown)="onMouseDown($event, comp)"
        (click)="selectComponent(comp, $event)"
        (contextmenu)="onComponentContextMenu($event, comp.id)"
      >
        {{ comp.content }}
      </button>
  
      <input
        *ngSwitchCase="'input'"
        type="text"
        class="absolute border px-2 py-1 rounded"
        [style.top]="comp.style.top"
        [style.left]="comp.style.left"
        [style.width]="comp.style.width"
        [style.height]="comp.style.height"
        [placeholder]="comp.content"
        (mousedown)="onMouseDown($event, comp)"
        (click)="selectComponent(comp, $event)"
        (contextmenu)="onComponentContextMenu($event, comp.id)"
      />
  
      <textarea
        *ngSwitchCase="'textarea'"
        class="absolute border px-2 py-1 rounded"
        [style.top]="comp.style.top"
        [style.left]="comp.style.left"
        [style.width]="comp.style.width"
        [style.height]="comp.style.height"
        [placeholder]="comp.content"
        (mousedown)="onMouseDown($event, comp)"
        (click)="selectComponent(comp, $event)"
        (contextmenu)="onComponentContextMenu($event, comp.id)"
      ></textarea>
  
      <select
        *ngSwitchCase="'select'"
        class="absolute border px-2 py-1 rounded"
        [style.top]="comp.style.top"
        [style.left]="comp.style.left"
        [style.width]="comp.style.width"
        [style.height]="comp.style.height"
        (mousedown)="onMouseDown($event, comp)"
        (click)="selectComponent(comp, $event)"
        (contextmenu)="onComponentContextMenu($event, comp.id)"
      >
        <option *ngFor="let opt of comp.content?.split('\n')">{{ opt }}</option>
      </select>
  
      <img
        *ngSwitchCase="'img'"
        [src]="comp.content"
        alt="imagen"
        class="absolute rounded"
        [style.top]="comp.style.top"
        [style.left]="comp.style.left"
        [style.width]="comp.style.width"
        [style.height]="comp.style.height"
        (mousedown)="onMouseDown($event, comp)"
        (click)="selectComponent(comp, $event)"
        (contextmenu)="onComponentContextMenu($event, comp.id)"
      />
  
      <input
        *ngSwitchCase="'checkbox'"
        type="checkbox"
        class="absolute"
        [style.top]="comp.style.top"
        [style.left]="comp.style.left"
        (mousedown)="onMouseDown($event, comp)"
        (click)="selectComponent(comp, $event)"
        (contextmenu)="onComponentContextMenu($event, comp.id)"
      />
  
      <input
        *ngSwitchCase="'radio'"
        type="radio"
        class="absolute"
        [style.top]="comp.style.top"
        [style.left]="comp.style.left"
        (mousedown)="onMouseDown($event, comp)"
        (click)="selectComponent(comp, $event)"
        (contextmenu)="onComponentContextMenu($event, comp.id)"
      />
    </ng-container>
  
    <!-- Renderizar hijos -->
    <ng-container *ngIf="comp.children">
      <ng-container *ngFor="let child of comp.children">
        <ng-container *ngTemplateOutlet="renderComponent; context: { comp: child }"></ng-container>
      </ng-container>
    </ng-container>
  </ng-template>
  
  
  
  


</div>